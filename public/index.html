<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8" />
      <link rel="apple-touch-icon" sizes="76x76" href="admin_files/assets/img/apple-icon.png">
      <link rel="icon" type="image/png" sizes="96x96" href="admin_files/assets/img/favicon.png">
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <title>Go Go Taxi</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <!-- Bootstrap core CSS     -->
      <link href="admin_files/assets/css/bootstrap.min.css" rel="stylesheet" />
      <!--  Paper Dashboard core CSS    -->
      <link href="admin_files/assets/css/paper-dashboard.css?v=1.2.1" rel="stylesheet"/>
      <!--  CSS for Demo Purpose, don't include it in your project     -->
      <link href="admin_files/assets/css/demo.css" rel="stylesheet" />
      <!--  Fonts and icons     -->
      <link href="admin_files/assets/css/font-awesome.min.css" rel="stylesheet">
      <link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
      <link href="admin_files/assets/css/themify-icons.css" rel="stylesheet">
   </head>
   <body>
      <nav class="navbar navbar-transparent navbar-absolute">
         <div class="container">
            <div class="navbar-header">
               <button type="button" class="navbar-toggle navbar-toggle-black" data-toggle="collapse" data-target="#navigation-example-2">
               <span class="sr-only">Toggle navigation</span>
               <span class="icon-bar "></span>
               <span class="icon-bar "></span>
               <span class="icon-bar"></span>
               </button>
            </div>
            <div class="collapse navbar-collapse">
               <ul class="nav navbar-nav navbar-right">
                  <li>
                     <a href="login.html" class="btn">
                     Agent login?
                     </a>
                  </li>
               </ul>
            </div>
         </div>
      </nav>
      <div class="wrapper wrapper-full-page">
         <div class="register-page">
            <!--   you can change the color of the filter page using: data-color="blue | azure | green | orange | red | purple" -->
            <div class="content">
               <div class="container">
                  <div class="row">
                     <div class="col-md-8 col-md-offset-2">
                        <div class="header-text">
                           <h2>Have a Problem ?</h2>
                           <h4>Solve it with 3 easy step.</h4>
                           <hr>
                        </div>
                     </div>
                     <div class="col-md-4">
                        <div class="media">
                           <div class="media-left">
                              <div class="icon icon-danger">
                                 <i class="ti ti-user"></i>
                              </div>
                           </div>
                           <div class="media-body">
                              <h5>Step 1</h5>
                              Create ticket with fill this form with your issue. Add attachment of image if needed.Click on Submit button
                           </div>
                        </div>
                        <div class="media">
                           <div class="media-left">
                              <div class="icon icon-warning">
                                 <i class="ti-bar-chart-alt"></i>
                              </div>
                           </div>
                           <div class="media-body">
                              <h5>Step 2</h5>
                              Save/Bookmark your ticket link for see your answer/update from our agent.
                           </div>
                        </div>
                        <div class="media">
                           <div class="media-left">
                              <div class="icon icon-info">
                                 <i class="ti-headphone"></i>
                              </div>
                           </div>
                           <div class="media-body">
                              <h5>Step 3</h5>
                              Make communication via saved link until not close ticket.
                           </div>
                        </div>
                     </div>
                     <div class="col-md-8">
                        <form id="new_post_form">
                           <div class="card card-plain">
                              <div class="content">
                                 <div class="form-group">
                                    <input type="text" id="name" placeholder="Name" class="form-control" required="">
                                 </div>
                                 <div class="form-group">
                                    <input type="text" id="email" placeholder="Email" class="form-control" required="">
                                 </div>
                                 <div class="form-group">
                                    <input type="text" id="subject" placeholder="Subject" class="form-control" required="">
                                 </div>
                                 <div class="form-group">
                                    <select class="selectpicker" id="cat_list" name="cat_list" required="" data-style="btn btn-block" title="Chose Category...">
                                    </select>
                                 </div>
                                 <div class="form-group">
                                    <input type="file" name="ticket_image" id="ticket_image" class="form-control">
                                 </div>
                                 <div class="form-group">
                                    <textarea  class="form-control" required="" rows="10" name="content" id="content" placeholder="Issue..."></textarea>
                                 </div>
                              </div>
                              <div class="footer text-center">
                                 <button type="submit" class="btn btn-fill btn-danger btn-wd">Create Ticket</button>
                              </div>
                           </div>
                        </form>
                     </div>
                  </div>
               </div>
            </div>
            <footer class="footer footer-transparent">
               <div class="container">
                  <div class="copyright text-center">
                     &copy; <script>document.write(new Date().getFullYear())</script>, made with <i class="fa fa-heart heart"></i> by <a href="#">GO-GO-TAXI</a>
                  </div>
               </div>
            </footer>
         </div>
      </div>
      <!--   Core JS Files. Extra: TouchPunch for touch library inside jquery-ui.min.js   -->
      <script src="admin_files/assets/js/jquery-3.1.1.min.js" type="text/javascript"></script>
      <script src="admin_files/assets/js/jquery-ui.min.js" type="text/javascript"></script>
      <script src="admin_files/assets/js/perfect-scrollbar.min.js" type="text/javascript"></script>
      <script src="admin_files/assets/js/bootstrap.min.js" type="text/javascript"></script>
      <!--  Forms Validations Plugin -->
      <script src="admin_files/assets/js/jquery.validate.min.js"></script>
      <!-- Promise Library for SweetAlert2 working on IE -->
      <script src="admin_files/assets/js/es6-promise-auto.min.js"></script>
      <!--  Plugin for Date Time Picker and Full Calendar Plugin-->
      <script src="admin_files/assets/js/moment.min.js"></script>
      <!--  Select Picker Plugin -->
      <script src="admin_files/assets/js/bootstrap-selectpicker.js"></script>
      <!--  Switch and Tags Input Plugins -->
      <script src="admin_files/assets/js/bootstrap-switch-tags.js"></script>
      <!--  Notifications Plugin    -->
      <script src="admin_files/assets/js/bootstrap-notify.js"></script>
      <!-- Sweet Alert 2 plugin -->
      <script src="admin_files/assets/js/sweetalert2.js"></script>
      <!--  Bootstrap Table Plugin    -->
      <script src="admin_files/assets/js/bootstrap-table.js"></script>
      <!-- Paper Dashboard PRO Core javascript and methods for Demo purpose -->
      <script src="admin_files/assets/js/paper-dashboard.js?v=1.2.1"></script>
      <!-- Paper Dashboard PRO DEMO methods, don't include it in your project! -->
      <script src="admin_files/assets/js/demo.js"></script>
      <script src="js/firebase_core.js"></script>
      <script src="js/firebase.js"></script>
      <script type="text/javascript">
         $(document).ready(function () {
             demo.checkFullPageBackgroundImage();
             function get_cat_list() {
         
         
                 var ref = firebase.database().ref().child("category");
                 ref.on("value", function (snapshot) {
                     snapshot.forEach(function (childSnapshot) {
         
                         var key = childSnapshot.key;
                         var childData = childSnapshot.val();
                         var html = '';
                         html = "<option value=" + childData.categoryName + ">" + childData.categoryName + "</option>";
         
                         $("#cat_list").append(html);
                         $("#cat_list").selectpicker("refresh");
                     });
                 }, function (error) {
                     console.log("Error: " + error.code);
                 });
             }
         
             get_cat_list();
         
             $('#new_post_form').validate();
             $("#new_post_form").submit(function (e) {
         
                 e.preventDefault();
                 if ($('#new_post_form').valid()) {
                     var name = $("#name").val();
                     var email = $("#email").val();
                     var subject = $("#subject").val();
                     var categoryName = $("#cat_list").find("option:selected").text();
                     var content = $("#content").val();
                     storage = firebase.storage();
                     var file = document.getElementById("ticket_image").files[0];
         var currentdate = new Date(); 
         
         var current_datetime =(currentdate.getMonth()+1)  + "/" 
         + currentdate.getDate() + "/"
         + currentdate.getFullYear() + " @ "  
         + currentdate.getHours() + ":"  
         + currentdate.getMinutes() + ":" 
         + currentdate.getSeconds();
         
         var ticket_code = Date.now();
                  if (file) { // returns true if the string is not empty
                         var storageRef = storage.ref().child('ticket');
                         var photoRef = storageRef.child(ticket_code.toString());
                         var uploadTask = photoRef.put(file);
                         uploadTask.on('state_changed', null, null, function () {
         
                             var downloadUrl = uploadTask.snapshot.downloadURL;
                            var updates = {};
                         updates['/ticket/'+ ticket_code] = {name:name,email:email, subject: subject, content: content, ticketpostImage: downloadUrl,categoryName: categoryName,status: 'Open',createdDate: current_datetime};
                         
                         firebase.database().ref().update(updates);
                           setTimeout(function () { window.location = "ticket_reply.html?id="+ticket_code; }, 1500);
                         });
                     } else { // no file was selected
                         var downloadUrl = '';
                        var updates = {};
                         
                        
                          updates['/ticket/'+ ticket_code] = {name:name,email:email, subject: subject, content: content, ticketpostImage: downloadUrl,categoryName: categoryName,status: 'Open',createdDate: current_datetime};
                         
                         var test=firebase.database().ref().update(updates);
                         
                        setTimeout(function () { window.location = "ticket_reply.html?id="+ticket_code; }, 1500);
                         
                     }
                    
                 }
             });
         
             setTimeout(function () {
                 // after 1000 ms we add the class animated to the login/register card
                 $('.card').removeClass('card-hidden');
             }, 700)
         });
      </script>
   </body>
</html>